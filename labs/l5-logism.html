<html>
<head>
	<meta charset="utf-8">
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, content=no-cache">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
	<link rel="stylesheet" href="../sty2.css">

  <title>Computer Systems Organization (Fall 2022) </title>
</head>

<body>
<br>
    <main role="main" class="container">
      <header class="header clearfix">
        <nav>
          <ul class="nav nav-pills float-left">
            <li class="nav-item">
              <a class="nav-link " href="../index.html">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../schedule.html">Schedule</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href=".">Lab</a>
            </li>
          </ul>
        </nav>
	<div class="row">
		<div class="col-sm-3"><img src="../org.png" width=150></div>
		<div class="col-sm-9">
		<div class="row">
        <h3 class="text-muted">Computer Systems Organization</h3>
		</div>
		<div class="row">
			CSCI-UA.0201(003), Fall 2022
		</div>
		</div>
	</div>
      </header>

<div id="content">
<hr>

<h2> Lab-5: Introduction to Logism</h2>


<h3>Setup</h3>

<p><font color="red">Unlike the previous labs which are done on snappy1, you can do this lab on your local Mac or Windows laptop.</font>
Follow the following 3 setup steps to download the required files.

<p>Step-1: Clone your Lab 5 repository 
<ul>
  <li>First, make your github repository by clicking the Github classroom invitation link (found on campuswire).
  <li>Second, clone your github repository on your laptop
      <pre>
    $ git clone git@github.com:nyu-cso-fa22/lab5-&lt;YourGithubUsername&gt;.git  lab5
    </pre>
</ul>

<p>If your local laptop does not have git already installed, follow the instructions <a href="https://github.com/git-guides/install-git">here</a> to install git.
</p>

<p>Step-2: If your laptop does not have java already installed, you need to install Java runtime.  Follow the instructions <a href="https://www.java.com/en/download/">here</a>.

<p>Step-3: Launch Logism Evolution.  On Windows, you can directly click the <tt>logisim-evolution-2.15.jar</tt> file in your local lab5 repository. 
On Mac, open a terminal, navigate to your lab5 repository directory which contains the <tt>logisim-evolution-2.15.jar</tt> file, and type the command:

<pre>
java -jar logisim-evolution-2.15.jar
</pre>.

<p>You will see the Logisim's GUI interface pop up.


<div class="bd-callout bd-callout-danger"><h5>Warning: Save often with Logism</h5>
  Logisim does not have autosave, i.e. it does not save your work as you go along. 
  It also does not automatically create a new .circ file when you open it! 
  Save when you start, and save frequently as you work.</p>
</div>

<h3>Warm-up on the basics</h3>
<p>We begin by creating a very simple circuit just to get the feel for placing
gates and wires. Before you start, take note of a useful feature: the zoom function! It's in the bottom left corner, and will make your life with Logisim much easier. </p>

<p align=center><img src="zoom.png" width=700></p>

<ul>
  <li><img class="btn" src="and.gif"> Start by clicking
    the &quot;AND gate&quot;  button (located on the toolbox bar immediately below the menu bar). This will cause the shadow of an AND gate
    to follow your cursor around. Click once within the main schematic window to
    place an AND gate.</li>

  <li><img class="btn" src="input.gif"> Click the &quot;Input Pin&quot; button.
    Now, place two input pins somewhere to the left of your AND gate.</li>

  <li><img class="btn" src="output.gif"> Click the &quot;Output Pin&quot; button.
    Then place an output pin somewhere to the right of your AND gate. Your
    schematic should look something like this at this point:
    <p><center>
      <img style="position:relative; top: 6px;" src="schematic1.gif">
    </center></p>
  </li>

  <li><img class="btn" src="selection.gif"> Click the &quot;Select tool&quot;
    button. Click and drag to connect the input pins to the left side of the AND
    gate. This will take several steps, as you can only draw vertical and
    horizontal wires. Just draw a wire horizontally, release the mouse button,
    then click and drag down starting from the end of the wire to continue
    vertically. You can attach the wire to any pin on the AND gate on the left
    side. Repeat the same procedure to connect the output (right side) of the
    And Gate to the LED. After completing these steps your schematic should look
    roughly like this:
    <p><center>
      <img style="position:relative; top: 6px;" src="schematic2.gif">
    </center></p>
    <p>You can also change the number of inputs of the &quot;AND gate&quot; by clicking it using the select tool and changing the properties in the bottom left segment of the window. This can also be done before you put down the component.</p>
  </li>

  <li><img class="btn" src="poke.gif"> Finally, click the &quot;Poke&quot; tool
    and try clicking on the input pins in your schematic. Observe what happens.
    Does this match with what you think an AND Gate should do?</p>

</ul>

<h3>Part 1: Sub-Circuits</h3>
<p>Just as C programs can contain helper functions, a schematic can contain
subcircuits. In this part of the lab, we will create several subcircuits to
demonstrate their use.</p>

<div class="bd-callout bd-callout-info"><h5>Subcircuit naming:</h5>
  Logisim Evolution won't let you name a subcircuit after a keyword (e.g. "NAND", "NOR"). 
  Additionally, circuit names must start with "A-Za-z", so no starting with numbers.
</div>

<h4>Warm-up:</h4>
      <ol>
        <li>Create a new schematic (File-&gt;New) for your work.</li>
        <li>Create a new subcircuit (Project-&gt;Add Circuit ). You will be prompted for
          a name for the subcircuit; call it AND1 (note the 1 at the end. As there is already a component called AND, you <i>cannot</i> call it AND).</li>
        <li>In the new schematic window that you see create a simple AND circuit with 4
          input pins on the left side and an output pin on the right side. Do this by using only 
          the built-in AND gate with 2 inputs only. You can change the labels for the inputs and output by selecting the input/output using the select tool and changing the property &quot;Label&quot; in the bottom left of the window.</li>
        <li>Go back to your &quot;main&quot; schematic by double-clicking &quot;main&quot;
          in the circuit selector at the left of the screen. Your original (blank)
          schematic will now be displayed, but your AND1 circuit has been stored.</li>
        <li>Now, single click the word &quot;AND1&quot; in the list. This will tell
          Logisim that you wish to add your &quot;AND1&quot; circuit into your
          &quot;main&quot; circuit. </li>
        <li>Try placing your AND1 circuit into the &quot;main&quot; schematic. If you did
          it correctly, you should see a gate with 4 input pins on the left and one
          output pin on the right. Try hooking input pins and output pins up to these and
          see if it works as you expect.</li>
</ol>

<h4>Part 1 exercise:</h4>
<p>Now, you are ready to complete the exercises for part1.

<p>Open the given schematic file called part1.circ (File-&gt;Open..)
  
<p>At the left of the screen, you'll see a set of existing subcircuits that have already been created for you.  Please 
    complete these subcircuits <b>using only AND, OR, and NOT gates and not the built-in NAND, NOR, XOR, Decoder, Multiplexer circuits</b>. The subcircuits you are asked to implement are: 
    <ul>
      <li> NAND1: a NAND gate</li>
      <li>NOR1: a NOR gate</li>
      <li>XOR1: a XOR gate</li>
      <li>NegSign: Negate the most significant bit (sign bit) of an 8-bit number. You can think of the 8-bit number as representing a signed integer in the "sign and magnitude" format (instead of 2's complement), thus this circuit negates the number.
      <li>Mux2to1: a 2-to-1 multiplexer</li>
      <li>Dec2to4: a 2-to-4 decoder </li>
      <li>Mux4to1: a 4-to-1 multiplexer. Hint: you may want to use the Dec2to4 subcuirt</li>
    </ul>


    <p>In order to faciliate testing of your subcircuits, we have fixed the locations of your subcircuits' input and output pins, using the Logisim functionality Tunnel (read more about <a href="#tunnel">here</a>).  To give you an idea of how to access the input and output signals, the image below shows an example (incorrect) implementation of the NAND1 subcircuit.

    <p align=center> <img src="example.jpg" width=600>

<p>Like the above example shows, all the gates and wires in your implementation should be below the line marked "Put your circuits below this line".  On top of the line, the input and output pins are connected to labelled <a href="#tunnel">tunnels</a>.  Underneath the line, your implementation can access the inputs using the corresponding labelled tunnels and also pass its output to the corresponding labelled tunnel(s), as shown in this example.

<p>When implementing NegSign and Dec2to4, you will also need to use Logisim functionality Splitter.  Read about <a href="#tunnel">Tunnel</a> and <a href="#splitter">Splitter</a> in the Logisim must-learn feature section.
</ul>

<h4> Testing Part1</h4>
<p>On Mac OS, test your part1 circuits by typing the following into a terminal, after navigating into your lab5 repository directory. 
The following output shows a run of successful test:

<p align=center><img src="part1_tests.png" width=700></p>
<!---
<pre>
$./test.sh part1
Copy part1.circ to tests/
Checking NAND... OK
Checking NOR... OK
Checking XOR... OK
Checking Mux2to1... OK
Checking NegSign... OK
Checking Dec2to4... OK
Checking Mux4to1... OK
</pre>
-->

<p>If you use a Windows laptop, you will have to run the test on snappy1.  To do so, follow the following 3 steps:
<ul>
  <li>First, on your windows laptop, push your local changes to github using <pre>git commit -am "..."; git push origin</pre>
  <li>Second, on snappy1, clone your lab5 directory (if you have not done so). <pre>git clone git@github.com:nyu-cso-fa22/lab5-&lt;YourGithubUsername&gt;.git </pre>
      Pull the changes into into this repository. <pre>git pull</pre>
  <li>Third, on snappy1, navigate to the lab5 repository, and type <pre>./test.sh part1</pre>.  
</ul>

<h3>Part 2: FSMs to digital logic</h3>

<h4>Warm-up: AddMachine</h4>
      <p>Let's implement a circuit that increments a
        value ad infinitum. The difference between this circuit and the circuits you've built
        in part1 is that you need some registers. The following will show you how to add
        registers to your circuit.

      <ol>
        <li>Do the warm-up in a new schematic file (File-&gt;New)</li>
        <li>Create a new subcircuit (Project-&gt;Add Circuit). Name this new subcircuit,
          AddMachine.</li>
        <li>Load in the Arithmetic Library if it is not already loaded (go to Project-&gt;Load
          Library-&gt;Built in Library and select "Arithmetic"). This library contains elements
          that will perform basic mathematical operations. When you load the library, the circuit
          browser at left will have a new "Arithmetic" folder.
          <p><center><img src=arithmetic.png width=200></center></p></li>
        <li>Select the adder subcircuit from the "Arithmetic" library and place the adder into
          your AddMachine subcircuit.</li>
        <li>Load in the Memory Library if it is not already loaded (go to Project-&gt;Load Library-&gt;Built in Library and select
          "Memory"). This library contains memory elements used to keep state in a circuit. A new
          "Memory" folder will appear in the circuit browser.</li>
        <li>Select the register from the "Memory" folder and place one register into your
          subcircuit. Below is an image diagraming the parts of a register.
          <p><center><img src=register.gif></center></p></li>
        <li>Connect a clock to your register. You can find the clock circuit element in the
          "Wiring" folder in the circuit browser.</li>
        <li>
          <p>Connect the output of the adder to the input of the register and the output of the register to the input of the adder.</p>
          <p>You may get a "Incompatible widths" error when you try to connect components. This means that your wire is trying to connect two pins
            together with different bit widths. If you click on the adder with the
            "Selection" tool, you will notice that there is a "Data Bit Width" property in the bottom left field of the window. This value determines the number of bits each input and output the adder has. Change this field to 8 and the "Incompatible widths" error should be resolved.</p>
        </li>
        <li>
          <p>Wire an 8-bit constant 1 to the second input of the adder. You can find the
          &quot;constant&quot; circuit element in the &quot;Wiring&quot; library.</p>
        </li>
        <li>
          <p>Add two output pins to your circuit so that you may monitor what comes out of the
          adder and the register. Make sure the output is 8 bits. Thus, by the end, your circuit should look like as follows:</p>
          <p><center><img src="AddMachine.png"></center></p>
        </li>
      </ol>

      <p>Now let's see if you built your circuit correctly.

      <ol>
        <li>Go back to the "main" subcircuit by double clicking on "main" in the circuit
          browser.</li>
        <li>Single click on your &quot;AddMachine&quot; circuit to select it.</li>
        <li>Change the "Facing" property to another direction. Any circuit with the "Facing"
          property can be rotated to accomodate wires as you need them. This will definitely be
          useful when you do your project.</li>
        <li>Place your AddMachine subcircuit into the main subcircuit. </li>
        <li>Select the AddMachine subcircuit you just placed into main.</li>
        <li>Connect output pins to the AddMachine subcircuit. Output pins are ordered top to
          bottom, left to right. Thus, if you followed the schematic above, then the top pin
          on the right side outputs the value of the adder, and the bottom pin is the output
          of the register.</li>
        <li>
          <p>Right click on your AddMachine subcircuit, and select &quot;View AddMachine. This
          is the <b><u>ONLY</u></b> method to preserve state (i.e. keep register values at its current value). Double-clicking on the circuit at
          the circuit browser at left makes logisim think you want to edit the circuit instead
          of just checking what state the circuit has.</p>
          <p><i>Note: You can use Simulate-&gt;Go In To State-&gt;*Circuit Name*, but that allows
          you go into the first circuit of that type. If you placed two Fib8 circuits down,
          it only takes you to the first Fib8 circuit you put down.</i></p>
        </li>
        <li>Initialize the register value to 1. You can do this by first, clicking on the
          register value with the poke tool. Then, type the hex value in.</li>
        <li>To return to the main circuit while preserving state, go to Simulate-&gt;Go Out To
          State-&gt;main. Alternatively, you can hold the Command key (control on windows) and
          press Up-Arrow.</li>
        <li>Now start running your circuit by going to Simulate-&gt;Ticks Enabled (or Command/Control + K). Your circuit
          should now be outputting a counter in binary form.</li>
        <li>If you want to run your circuit faster, you can change the tick frequency in
          Simulate-&gt;Tick Frequency.</li>
      </ol>

 <h4>Part 2 exercise</h4>

 <p>Now you are ready to do something really cool; translate a FSM (Finite State Machine) into a digital logic
        circuit.</p>
      <p>A FSM keeps track of inputs given,
      moves between states based on these inputs, and outputs something everytime something is input.</p>
      <p>In particular, the AddMachine we just built
        for the warm-up looks eerily similar to the diagram of a general FSM circuit.
        The skeleton file we give you contains a similar circuit. Modify this circuit to implement the following FSM:</p>

      <p><i>If two ones in a row or two zeroes in a row have ever been seen, output zeros
        forever. Otherwise, output a one.</i></p>

      <ol>
        <li>
          <p>Note that the FSM is implemented by the following diagram:</p>
          <center><img src="FSM.png"></center>
        </li>
        <li>
          <p>Observe that the following is a truth table for the FSM:</p>
          <p>
          <!--<table width="40%"  border="0" align="center">
           -->
           <table class="table table-sm">
              <thead class="thead-dark">
                <tr>
                  <td>st1</td>
                  <td>st0</td>
                  <td>input</td>
                  <td>|</td>
                  <td>next st1</td>
                  <td>next st0</td>
                  <td>output</td>
                </tr>
              </thead>
              <tbody>
                <tr><td>0</td><td>0</td><td>0</td><td>|</td><td>0</td><td>1</td><td>1</td></tr>
                <tr><td>0</td><td>0</td><td>1</td><td>|</td><td>1</td><td>0</td><td>1</td></tr>
                <tr><td>0</td><td>1</td><td>0</td><td>|</td><td>1</td><td>1</td><td>0</td></tr>
                <tr><td>0</td><td>1</td><td>1</td><td>|</td><td>1</td><td>0</td><td>1</td></tr>
                <tr><td>1</td><td>0</td><td>0</td><td>|</td><td>0</td><td>1</td><td>1</td></tr>
                <tr><td>1</td><td>0</td><td>1</td><td>|</td><td>1</td><td>1</td><td>0</td></tr>
                <tr><td>1</td><td>1</td><td>0</td><td>|</td><td>1</td><td>1</td><td>0</td></tr>
                <tr><td>1</td><td>1</td><td>1</td><td>|</td><td>1</td><td>1</td><td>0</td></tr>
              </tbody>
            </table>
          </p>
        </li>
        <li>
          <p>We've provided you with a starter Logisim circuit to start out in FSM.circ</p>
        </li>
        <li>
        <p>Note that the top level of the circuit looks almost exactly the same as our
          previous adder circuit, but now there's a FSMLogic block instead of an adder block.
          FSMLogic is the combinational logic block for this FSM. We have handled the output
          bit for you, as it's the most complicated to simplify and implement. You should
          complete the circuit by completing the StateBitOne and StateBitZero subcircuits, which produces the next state bits.</p>
        <p>You <strong>could</strong> go from the truth table to SOP to a circuit, or you
          could notice that for each state bit, there are only two situations in which it
          is zero. This could make your life easier if you think a bit outside the box...
        </li>
      </ol>

<h4> Testing FSM</h4>
<p>Test your FSM circuits as follows (the output shows a run of successful test):
<pre>
$./test.sh FSM
Copy FSM.circ to tests/
Checking FSM...OK
</pre>

<h3>Bonus exercise: Logical Shift Right</h3>
As a bonus, you are to implement a non-trivial combinational logic block: <code>shr</code>, which is the logical right shift operation.  <code>shr A, B</code> will shift the bit pattern of input A to the right by B bits, filling 0-bits from the left.  In C, this amounts to calculating <code> R = A &gt;&gt; B</code>
      <p>We have provided you with a starter Logisim circuit file called <code>shr.circ</code>. Implement your logical right shift operator in the <code>shr</code> subcircuit.  Play with and test your <code>shr</code> subcircuit in the TestMain subcircuit.

      <p>Your <code>shr</code> subcircuit has the following inputs:
        <ul>
          <li><strong>A</strong>, 8 bits, the input to be shifted </li>
          <li><strong>B</strong>, 3 bits, the shift amount</li>
        </ul>

        <p>
        You are <strong>NOT allowed</strong> to use Logisim shifters in your solution, though all other combinational logic (MUXes, constants, gates, adders, etc.) is allowed. Logisim's built-in MUXes (find them under the Plexers menu) might be especialy helpful. Your solution shouldn't involve a clock or any clocked elements, like registers.
      </p>

      <p>
      <b>Hint:</b> Just because we gave you an RTL representation doesn't mean it's the best way to look at this problem. Think about the input bits of <strong>B</strong> and think about how to effectively use splitters! Can you do something with the binary form? Remember why binary is good for use in computers: a 1 is easy to represent as an "ON" signal, and a 0 is easy to represent as an "OFF" signal. Let's say we want to rotate 6 times. 6 is 110 in binary, or 1*0x4 + 1*0x2 + 0*0x1. Can you use this to make a cleaner circuit?</p>
      <p>

<h4> Testing shr</h4>
<p>Test your <code>shr</code> circuits as follows (the output shows a run of successful test):
<pre>
$./test.sh shr
Copy shr.circ to tests/
Checking shr... OK
</pre>

      <h3>Must-learn Logisim features</h3>
	  <h4 id="splitter">Splitters</h4>
	  <p>Splitters allow you to take a multi-bit value and split it up into smaller parts, or (despite the name) combine multiple values that are one or more bits into a single value. For example, we split the 4-bit binary number "1001" into "10" and "01", then recombine it with "11" into the final 6-bit number "111001": </p>
	  <img src="splitter_intro.png" width=350>
    <p>Click on a splitter to get its menu in the sidebar. You can use this menu to determine the number of arms on your splitter and how many bits should go on each arm. For the circuit above, the left splitter's menu looks like this:</p>
	  <img src="left_split_menu.png" width=350>
	  <p>While the right splitter's menu looks like this:</p>
	  <img src="right_split_menu.png" width=350>
    <p><b>Notice that there's an option called "facing".</b> You can use this to rotate your splitter. Above, see that the splitter on the right is facing West while the splitter on the left is facing East.</p>
	  <p>If you see an error wire that is orange, this means that your bit width in does not match your bit width out. Make sure that if you're connecting two components with a wire, you correctly set the bit width in that component's menu.</p>
	  <img src="orange_error.png" width=350>
	  </div>

    <div class="section">
            <h4 id="tunnel">Tunnels</h4>
            <p>A tunnel allows you draw an "invisible wire" to bind two
              points together. Tunnels are grouped by case-sensitive
              labels give to a wire.  They are used to connect wires
              like so:</p>
            <img src="tunnels1.png">
            <p>Which has an effect such as the following:</p>
            <img src="tunnels2.png">
            <p>Some care should be taken as to which wires are connected with tunnels to
              which other wires, such as in this case:</p>
            <img src="tunnels3.png">
            <p>Which in turn has the following effect:</p>
            <img src="tunnels4.png">

            <p>
            We <em>strongly</em> recommend you use tunnels with Logisim, because they make your circuits much cleaner looking, and therefore easier to debug.
            </p>
          </div>

	<div class="section">
            <h4 id="extender">Extenders</h4>
            <p>When changing the width of a wire, you should use a bit extender for clarity.
              For example, consider the following implementation of extending an 8-bit wire
              into a 16-bit wire:</p>
            <img src="extend1.png">
            <p>Whereas the following is much simpler, easier to read, and less error-prone:</p>
            <img src="extend2.png">
            <p>Additionally consider the case of throwing out bits. In this example, an 8-bit
              wire is being converted into a 4-bit wire by throwing out the other bits:</p>
            <img src="extend3.png">
            <p>Despite the implications of its name, a bit extender can also do this same
              operation:</p>
            <img src="extend4.png">
          </div>

    </div>

<h3>Handin Procedure</h3>

Follow these <a href="index.html#handin">instructions</a>.


<h4>Acknowledgements</h4>
This lab is borrowed and adapted from Berkeley's CS61c class.


</div>
</body>
</html>
